<!--
同步影响报告:
- 版本变更: 1.0.0 → 1.0.1 (语言本地化)
- 修改的原则: 全部翻译为中文，内容不变
- 新增章节: 无
- 移除章节: 无
- 需要更新的模板:
  ✅ plan-template.md - Constitution Check 兼容
  ✅ spec-template.md - 需求对齐兼容
  ✅ tasks-template.md - 任务分类兼容
- 后续待办: 无
-->

# 售后工单管理系统 项目宪法

## 核心原则

### 一、AI 优先的数据基础

本系统定位为**未来 AI 集成的数据基础**。所有数据模型、API 和服务必须考虑 AI 的消费模式。

- 所有工单数据必须结构化，便于机器读取
- 必须维护嵌入向量和相似工单检索能力
- 数据模式必须支持未来 AI 功能（标签生成、处理建议、智能分类）
- 理由：核心业务价值在于实现 AI 驱动的售后智能

### 二、分层架构

系统遵循严格的三层架构：

- **API 层** (`app/api/`)：仅处理 HTTP 请求/响应，委托给服务层
- **服务层** (`app/services/`)：包含所有业务逻辑，不涉及 HTTP
- **模型层** (`app/models/`)：纯数据结构，使用 Pydantic 验证

控制器不得包含业务逻辑。服务层不得直接处理 HTTP。

理由：关注点分离便于测试、维护和未来 AI 服务扩展。

### 三、双语支持

所有代码文档、注释和面向用户的文本必须支持中英文：

- API 响应：使用中文错误消息服务终端用户
- 代码注释：使用英文便于国际化协作
- 领域术语：使用既定双语术语表（工单=Ticket，售后=After-Sale）

理由：系统服务中文用户，但开发可能涉及国际协作者。

### 四、Docker 优先的基础设施

所有基础设施依赖必须容器化，可通过 docker-compose 编排：

- MongoDB、Milvus、etcd、MinIO 必须通过 docker-compose 运行
- 本地开发必须能够通过单条 `docker-compose up -d` 命令启动
- 无需手动安装数据库服务

理由：确保开发环境一致性，简化项目启动流程。

### 五、简单优于抽象

遵循 YAGNI（你不会需要它）原则：

- 不做投机性的抽象或设计模式
- 通过 Motor 直接访问数据库是可接受的，无需仓储模式
- 优先使用简单函数而非类继承
- 仅在当前需求明确需要时才增加复杂度

理由：这是一个专注的工单管理系统，不是通用框架。

## 技术栈

### 后端

- **语言**: Python 3.11+
- **框架**: FastAPI，使用 async/await
- **数据库**: MongoDB 7.0（通过 Motor 异步驱动）
- **向量数据库**: Milvus v2.3.3（用于工单嵌入）
- **AI 服务商**: 智谱 AI（embedding-3, GLM-4-flash）

### 前端

- **框架**: React 19 + TypeScript
- **构建工具**: Vite
- **UI 组件库**: Ant Design
- **图表库**: ECharts

### 基础设施

- **容器运行时**: Docker + docker-compose
- **对象存储**: MinIO（Milvus 依赖）
- **元数据存储**: etcd（Milvus 依赖）

## 开发流程

### 代码质量

- 所有 Python 函数必须使用类型注解
- 必须启用 TypeScript 严格模式
- API 端点必须有 Pydantic 请求/响应模式
- 提交前必须通过代码检查（前端 ESLint，后端 ruff/pyright）

### 测试

- 鼓励单元测试，但不强制要求覆盖所有代码
- 关键业务流程必须包含集成测试：
  - 工单创建与 ID 生成
  - AI 相似工单检索
  - 状态流转

### Git 工作流

- 功能分支命名格式：`###-feature-name`
- 提交应当原子化且描述清晰
- 破坏性变更必须在提交信息中说明

## 治理

本宪法优先于所有其他开发实践和约定。

### 修订流程

1. 提出修订并说明理由
2. 评估对现有代码和模板的影响
3. 按语义化版本规则递增版本号：
   - 主版本（MAJOR）：删除原则或不兼容的变更
   - 次版本（MINOR）：新增原则或扩展指导
   - 补丁版本（PATCH）：澄清和措辞修正
4. 更新相关模板（plan、spec、tasks）

### 合规检查

- 所有 PR 必须验证是否符合相关原则
- 代码审查时必须说明引入非必要复杂度的理由
- 运行时开发指南参见 `CLAUDE.md`

**版本**: 1.0.1 | **批准日期**: 2025-02-26 | **最后修订**: 2025-02-26
